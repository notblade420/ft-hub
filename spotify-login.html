
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login with Spotify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #111;
      color: #e0ffe0;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      padding-top: 100px;
    }
    button {
      padding: 1rem 2rem;
      font-size: 1rem;
      background-color: #1db954;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #1ed760;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ§ FourTwenty Hub</h1>
  <p>Secure Spotify login with PKCE</p>
  <button id="login-btn">Login with Spotify</button>

  <script>
    const clientId = "55f5219aba8a4195b35e5ccb02cf6199";
    const redirect_uri = "https://ft-hub-420420.netlify.app/callback.html";
    const scope = "streaming user-read-email user-read-private";

    async function generateCodeChallenge(codeVerifier) {
      const data = new TextEncoder().encode(codeVerifier);
      const digest = await crypto.subtle.digest("SHA-256", data);
      return btoa(String.fromCharCode(...new Uint8Array(digest)))
        .replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");
    }

    function generateRandomString(length) {
      const possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      return Array.from(crypto.getRandomValues(new Uint8Array(length)))
        .map(x => possible.charAt(x % possible.length)).join("");
    }

    document.getElementById("login-btn").addEventListener("click", async () => {
      const codeVerifier = generateRandomString(128);
      const codeChallenge = await generateCodeChallenge(codeVerifier);
      localStorage.setItem("code_verifier", codeVerifier);

      const args = new URLSearchParams({
        response_type: "code",
        client_id: clientId,
        scope: scope,
        redirect_uri: redirectUri,
        code_challenge_method: "S256",
        code_challenge: codeChallenge,
      });

      window.location = "https://accounts.spotify.com/authorize?" + args;
    });
  </script>
  <script src="script.js"></script>
</body>
</html>
